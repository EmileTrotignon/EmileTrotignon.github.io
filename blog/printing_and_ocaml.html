<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><title>Émile Trotignon's personal page</title><meta charset="utf-8"/><meta name="viewport" content="width=device-width, initial-scale=1"/><link rel="stylesheet" href="/style.css"/><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@700&amp;display=swap"/><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Fira+Sans&amp;display=swap"/><script src="https://kit.fontawesome.com/0c027fe19b.js" crossorigin="anonymous"></script></head><body><header><canvas resize="true" id="voronoi" style="user-select: none;" data-paper-scope="1"></canvas><h1><a href="/">Émile Trotignon</a></h1></header><div id="body"><nav id="sidebar"><section id="navmenu"><a href="/" class="button">Index</a><a href="/software" class="button">Software</a><a href="/resume" class="button">Resume</a><a href="/blog" class="button current" id="blog-navlink">Blog</a></section><section><p><a href="https://github.com/EmileTrotignon"><img src="/icons/github-icon.svg" alt="Github icon" class="icon"/>Github</a></p><p><a href="mailto:emile.trotignon@gmail.com"><span class="icon"><i class="fas fa-envelope fa-lg"></i></span>emile.trotignon@gmail.com</a></p><p>Born July 30th, 1999</p></section></nav><ul id="breadcrumbs"><li><a href="/">~</a></li><li><a href="/blog">blog</a></li><li><a href="/blog/printing_and_ocaml.md">printing_and_ocaml.md</a></li></ul><article id="content"><h1>Printing and OCaml</h1>
<p>Printing values for debugging purposes is often presented as one of the big pains of the OCaml experience, and I agree with that sentiment. There is no
simple way to print most datatypes, it either requires some external dependecies
or writing a bit of code. One of the proposed solution for this is modular
implicits. In this post I will argue that while modular implicits would help with
printing a lot, they are not sufficient on their own, and it would be possible
to improve the printing experience a lot without them.</p>
<h2>Modular implicits</h2>
<p>Modular implicits are a very powerful feature which requires a lot of research
and implementation work, and are not going to be available for a very long time.
It would allow us to do as following:</p>
<pre><code class="language-ocaml">module type Printable = sig
  type t

  val print&amp;nbsp;: t -&gt; out_channel -&gt; unit
end

(* Such constraints are not possible in OCaml for now *)
let print (M&amp;nbsp;: Printable) (v&amp;nbsp;: M.t) out_channel =
  M.print v out_channel

let () =
  (* Here is the implicit part&amp;nbsp;: you do not need to give the module [Int], it is
     selected automatically because it fits the signature *)
  print 123
</code></pre>
<h2>Modular implicits are not enough</h2>
<p>This is very cool, but having modular implicits on its own would not solve the
printing issue. You would also need <code>Int</code> to be printable, and currently it is not
and no module in the Stdlib is.</p>
<p>There are obviously functions to print many types, but none of them are in their
respective modules. You have <code>output_int</code>, <code>Format.pp_print_int</code>, but not
<code>Int.print</code>. More complex types like <code>'a list</code> only have function to print them
in <code>Format</code>, were they might be hard to find.
This may seems like a detail because adding such functions would be very easy
compared to implementing modular implicits, but I believe it is
a low-hanging fruit.</p>
<p>If such functions existed in every module in the Stdlib, we could say to
beginners something like:</p>
<ul>
<li>To print a value of type <code>M.t</code>, you do <code>M.print</code>.
That would be a whole lot better than to tell them that they have to handle it
themselves. And I would even go as far as to say that it is just as good as
modular <strong>explicits</strong>, that is a version of the above code where you have to specify
the module: <code>print Int 123</code> is not that different from <code>Int.print 123</code>.</li>
</ul>
<p>That is to say, modular implicits give inference for printing, which is very
good, but a lot of langages that have a typeclass-like thing for printing do not
have very good type inference, and (almost) catching up with them would only
require small changes to the Stdlib.</p>
<p>In c++, you could write :</p>
<pre><code class="language-c++">int x = 123;
cout &lt;&lt; x;
</code></pre>
<p>and in Ocaml with the changes I talk about that would be</p>
<pre><code class="language-ocaml">let x = 123 in
Int.print x
</code></pre>
<p>The explicit typing is done the same number of times, and I think they are both
equally reasonable ways to print.</p>
<p>There is also the case of types that have an abstract parameter like <code>'a list</code>.
In that case, you need an extra argument to the <code>print</code> function. The comparison
then becomes</p>
<pre><code class="language-c++">vector&lt;int&gt; arr = {1; 2&amp;nbsp;;3};
cout &lt;&lt; arr;
</code></pre>
<pre><code class="language-ocaml">let arr = [|1; 2; 3|] in
Array.print Int.print arr
</code></pre>
<p>Here ocaml is only slightly worse because you need to repeat <code>print</code>, but it is
still very much manageable, and it would be possible to write a small syntax
extension that removes this annoyance. It could look like that, and it does not
need to part of the stdlib:</p>
<pre><code class="language-ocaml">let arr = [|1; 2; 3|] in
print_endline {%fmt|arr = %{arr&amp;nbsp;: Array[Int]} |}
</code></pre>
<p>One thing that OCaml would still be bad at is printing value with abstract types.
In c++ you could do:</p>
<pre><code class="language-c++">template&lt;class T&gt;
void f( vector&lt;T&gt; arr) {
  cout &lt;&lt; arr;
  ...
}
</code></pre>
<p>whereas in ocaml, you would need to do the following:</p>
<pre><code class="language-ocaml">let f (arr&amp;nbsp;: 'a array) =
  Array.print ???.print arr
</code></pre>
<p>which is not possible.</p>
<p>But I still think that being able to say &quot;printing is pain when you have
abstract type&quot; is ten times better than having to admit that printing is a pain
most of the time.</p>
<h2>The standard issue</h2>
<p>While adding the printing functions would not be very hard, deciding exactly
what to add may be harder:
What is the type of the <code>print</code> function? What exactly does it print?
This can be quite hard to decide, as it is a design question that does not have
a unique answer, but I think this discussion is worthwile. I will try to propose
design ideas in the future.</p>
</article></div><script src="/highlight.js"></script><script src="/voronoi.js"></script></body></html>